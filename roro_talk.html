<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <style>
        .reveal .fake-game {
            background-color: #ddd;
            width: 90%;
            margin: 20px auto;
        }

        .reveal .fake-game-nav {
            background-color: #1b91ff;
        }

        .reveal .fake-game-status {
            text-align: left;
            width: 90%;
            margin: 20px auto;
        }

        .reveal .fake-game-main {
            display: flex;
            flex-direction: row;
            width: 90%;
            margin: 20px auto;
        }

        .reveal .fake-game-row {
            display: flex;
            flex-direction: row;
        }

        .reveal .fake-game-image {
            background-color: #ccc;
            width: 2em;
            height: 2em;
            border: none;
            margin: 5px 5px 0 0;
        }

        .reveal .fake-game-guess-container {
            width: 50%;
        }

        .reveal .fake-game-guess-container textarea {
            font-size: 1em;
        }

        .reveal .fake-game-guess {
            width: 100%;
            height: 100%;
        }

        .reveal .fake-game ul {
            list-style: none;
        }

        .reveal .slides > section, .reveal .slides > section > section {
            padding: 0px;
        }

        h4.code-snippet-title {
            text-align: left;
            width: 90%;
            margin: 20px auto;
        }

        .what-is-the-app-image-area {
            width: 75%;
            margin: auto !important;
        }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Failing for the right reason</h1>
            <h3>Selena Small & Michael Milewski</h3>
            <aside class="notes">
                Hi everyone, I’m Selena and this is Michael and we have an awesome idea for an app!
                It’s gonna be big, like, the next Facebook

                But how are we going to failsafe the software? When our empire starts growing and we’re adding
                features left, right and centre to keep our consumers happy, how will we ensure that a new piece
                of code doesn’t break one of the original features?

                The answer is simple. We are talking to you today about "Failing for the right reason!" - how to
                write tests that fail and drive out a perfect design for your software

                So, here's the idea for the app!
            </aside>
        </section>

        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-1-enter-url.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper visits SearchTerm
                -
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-2-welcome-text.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper visits SearchTerm
                - <mark>Then a welcome message is shown</mark>
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-3-start-button.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper visits SearchTerm
                - Then a welcome message is rendered
                - <mark>And a start game button is rendered</mark>
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-4-click-start-button.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper starts the game
                -
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-5-round-1.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper starts the game
                - <mark>Then round 1 begins</mark>
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-6-images.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper starts the game
                - Then round 1 begins
                - <mark>And 9 images are displayed</mark>
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-7-text-area-.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper starts the game
                - Then round 1 begins
                - And 9 images are displayed
                - <mark>And a text area is rendered</mark>
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-8-timer.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper starts the game
                - Then round 1 begins
                - And 9 images are displayed
                - And a text area is rendered
                - <mark>And a countdown timer is rendered</mark>
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-9-status.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When the game is In-progress
                -
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-10-counting-down.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When the game is In-progress
                - <mark>Then the countdown timer starts counting down</mark>
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-11-guess.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper guesses the search term used to find these images
                -
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-12-timer-stops.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper guesses the search term used to find these images
                - <mark>Then the countdown timer stops</mark>
                -
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-13-score.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper types the correct guess into the text box
                - Then the countdown timer stops
                - <mark>And a score is rendered for the round</mark>
                -
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>
        <section>
            <h3>What is the app?</h3>
            <div class="what-is-the-app-image-area">
                <img src="images/app-14-winner.png" style="" />
            </div>

            <pre><code data-trim data-noescape>
                - When Casper types the correct guess into the text box
                - Then the countdown timer stops
                - And a score is rendered for the round
                - <mark>And a winner message is rendered</mark>
                -
            </code></pre>
            <aside class="notes">
            </aside>
        </section>


        <!-- # TODO Michael analogy of why testing matters -->
        <section>
            <h3>Why testing matters</h3>
            <ul>
              <li class="fragment">incremental iterative development</li>
              <li class="fragment"><img src="images/rachet_and_prawl.jpg" /></li>
            </ul>
            <aside class="notes">
                Cool app! Seems pretty straight forward, do we really need to write tests though? We could just build it

                There are many reasons to test, but for the context of todays
                talk it is about incremental iterative development.

                Might sound a little counter intuitive "hey I just want to
                write the code" "No write a test first" but you will write code
                faster and sooner, a little bit of test and some code, some
                test and some code. No big upfront design learn more about your
                problem through actual code and allow yourself to pivot as you
                implement your solution not once it is complete and you need
                Test first to make your code tested to be able to iterate
                knowing that everything you have done still works. It is like a
                ratchet
            </aside>
        </section>

        <section>
            <h3>Flows - the Unit under test</h3>
        </section>

        <section>
            <h3>Flows - testing behaviour</h3>
            Set up context, invoke the thing, make an assertion

            Early on in the development cycle, there is no context but the thing is a component rendering images
            We want to assert that the images will be rendered at the right time
        </section>

        <section>
            <h3>Flows - documenting behaviour</h3>
            Language matters
            Test is largely documenting how to use that thing

            What is the behaviour we want to document here? When the game starts, images are rendered
        </section>

        <!-- # TODO 3 basic iterations building out the code -->
        <section>
            <h3>Iteration - small frequent changes</h3>
            Good software design = small isolated change, loosely coupled design
        </section>

        <section>
            <h3>1 - Render images</h3>
            <h4>Failing test</h4>
            <div>Img: empty browser page</div>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  scenario 'WINNING a game' do
                    When 'user starts the game' do
                      visit('/')
                      wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                When user starts the game - failing because no code has been implemented!
            </aside>
        </section>
        <section>
            <h3>1 - Render images</h3>
            <h4>Make it pass</h4>
            <div>Img: Welcome to the game text</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>1 - Render images</h3>
            <h4>Failing test</h4>
            <div>Img: Welcome to the game text</div>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  scenario 'WINNING a game' do
                    When 'user starts the game' do
                      visit('/')
                      wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                      focus_on(:welcome).start_game
                    end

                    Then 'the game commences' do
                      pending 'start game button doesnt start a game!'
                      wait_for { focus_on(:game).round }.to eq('1')
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                Start game button not implemented
            </aside>
        </section>
        <section>
            <h3>1 - Render images</h3>
            <h4>Make it pass</h4>
            <div>Img: Gif clickable start button</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>1 - Render images</h3>
            <h4>Failing test</h4>
            <div>Img: Rounds 1 is a blank screen</div>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  scenario 'WINNING a game' do
                    When 'user starts the game' do
                      visit('/')
                      wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                      focus_on(:welcome).start_game
                    end

                    Then 'the game commences' do
                      wait_for { focus_on(:game).round }.to eq('1')
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                routing works, there's nothing on the first round
            </aside>
        </section>
        <section>
            <h3>1 - Render images</h3>
            <h4>Make it pass</h4>
            <div>Img: Gif click start game navigates to round 1 with text round 1</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>1 - Render images</h3>
            <h4>Failing test</h4>
            <div>Img: Round 1 has no images</div>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  scenario 'WINNING a game' do
                    When 'user starts the game' do
                      visit('/')
                      wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                      focus_on(:welcome).start_game
                    end

                    Then 'the game commences' do
                      wait_for { focus_on(:game).round }.to eq('1')
                      pending 'There are no images!'
                      wait_for { focus_on(:game).images.count }.to eq(9)
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                Image search service not yet implemented
            </aside>
        </section>
        <section>
            <h3>1 - Render images</h3>
            <h4>Make it pass</h4>
            <div>Img: Gif click start game navigates to round 1 with text round 1 and images appear</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>1 - Render images</h3>
            <h4>First iteration</h4>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  scenario 'WINNING a game' do
                    When 'user starts the game' do
                      visit('/')
                      wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                      focus_on(:welcome).start_game
                    end

                    Then 'the game commences' do
                      wait_for { focus_on(:game).round }.to eq('1')
                      wait_for { focus_on(:game).images.count }.to eq('9')
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                First basic iteration of creating the game
            </aside>
        </section>


        <section>
            <h3>2 - Win by submitting a guess</h3>
            <h4>Failing test</h4>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  scenario 'WINNING a game' do
                    When 'user starts the game' do
                      visit('/')
                      wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                      focus_on(:welcome).start_game
                    end

                    Then 'the game commences' do
                      wait_for { focus_on(:game).round }.to eq('1')
                <mark>wait_for { focus_on(:game).status }.to eq('IN-PROGRESS')</mark>
                      wait_for { focus_on(:game).images.count }.to eq(9)
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                loading -> in progress
            </aside>
        </section>
        <section>
            <h3>2 - Win by submitting a guess</h3>
            <h4>Make it pass</h4>
            <div>Img: Gif game status changes from loading to in-progress</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>2 - Win by submitting a guess</h3>
            <h4>Failing test</h4>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  context 'the game terms are configured' do
                    before do
                      Term.create(phrase: 'tequila')
                    end

                    scenario 'WINNING a game' do
                      When 'user starts the game' do
                        visit('/')
                        wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                        focus_on(:welcome).start_game
                      end

                      Then 'the game commences' do
                        wait_for { focus_on(:game).round }.to eq('1')
                        wait_for { focus_on(:game).status }.to eq('IN-PROGRESS')
                        wait_for { focus_on(:game).images.count }.to eq(9)
                      end

                      When 'the user submits an answer' do
                        focus_on(:game).fill_guess('tequila')
                      end

                      Then 'the user wins' do
                        pending
                        wait_for { focus_on(:game).status }.to eq('WINNER')
                      end
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                new context, create term in the database so we can assert a winner
            </aside>
        </section>
        <section>
            <h3>2 - Win by submitting a guess</h3>
            <h4>Make it pass</h4>
            <div>Img: Gif fill in text tequila and see WINNER appear</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>2 - Win by submitting a guess</h3>
            <h4>Second iteration</h4>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  context 'the game terms are configured' do
                    before do
                      Term.create(phrase: 'tequila')
                    end

                    scenario 'WINNING a game' do
                      When 'user starts the game' do
                        visit('/')
                        wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                        focus_on(:welcome).start_game
                      end

                      Then 'the game commences' do
                        wait_for { focus_on(:game).round }.to eq('1')
                        wait_for { focus_on(:game).status }.to eq('IN-PROGRESS')
                        wait_for { focus_on(:game).images.count }.to eq(9)
                      end

                      When 'the user submits an answer' do
                        focus_on(:game).fill_guess('tequila')
                      end

                      Then 'the user wins' do
                        wait_for { focus_on(:game).status }.to eq('WINNER')
                      end
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                Second basic iteration of creating the game
            </aside>
        </section>


        <section>
            <h3>3 - Multi-round game</h3>
            <h4>Failing test</h4>
            <pre><code data-trim data-noescape>
                When 'the user starts the next round' do
                  focus_on(:game).next_round
                end

                Then 'round two starts' do
                  pending
                  wait_for { focus_on(:game).round }.to eq('2')
                end
            </code></pre>
            <aside class="notes">
                In a slightly more built out version, we can now easily develop this into a mutli-round game
                Round 2 is very similar to round 1
                And we expect a game to play out very similarly to what plays in round 1
            </aside>
        </section>
        <section>
            <h3>3 - Multi-round game</h3>
            <h4>Make it pass</h4>
            <div>Img: Gif playing through 2 rounds</div>
            <pre><code data-trim data-noescape>
                code to make it pass
            </code></pre>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h3>3 - Multi-round game</h3>
            <h4>Third iteration</h4>
            <pre><code data-trim data-noescape>
                feature 'Game play lifecycle', js: true do
                  context 'the game terms are configured' do
                    before do
                      Term.create(phrase: 'tequila')
                    end

                    scenario 'WINNING a game' do
                      When 'user starts the game' do
                        visit('/')
                        wait_for { focus_on(:welcome).text }.to eq('Welcome to the Game')

                        focus_on(:welcome).start_game
                      end

                      Then 'the game commences' do
                        wait_for { focus_on(:game).round }.to eq('1')
                        wait_for { focus_on(:game).status }.to eq('IN-PROGRESS')
                        wait_for { focus_on(:game).timer }.to match(/[0-9]/)
                        wait_for { focus_on(:game).images.count }.to eq(9)
                      end

                      When 'the user submits an answer' do
                        focus_on(:game).fill_guess('tequila')
                      end

                      Then 'the user wins the round' do
                        wait_for { focus_on(:game).status }.to eq('WINNER')
                        wait_for { focus_on(:game).score }.to match(/[0-9]/)
                      end

                      When 'the user starts the next round' do
                        focus_on(:game).next_round
                      end

                      Then 'round two starts' do
                        wait_for { focus_on(:game).round }.to eq('2')
                        wait_for { focus_on(:game).status }.to eq('IN-PROGRESS')
                        wait_for { focus_on(:game).timer }.to match(/[0-9]/)
                        wait_for { focus_on(:game).images.count }.to eq(9)
                      end

                      When 'the user submits an answer' do
                        focus_on(:game).fill_guess('tequila')
                      end

                      Then 'the user wins the round' do
                        wait_for { focus_on(:game).status }.to eq('WINNER')
                        wait_for { focus_on(:game).score }.to match(/[0-9]/)
                      end
                    end
                  end
                end
            </code></pre>
            <aside class="notes">
                Third basic iteration of creating the game

                So there you have 3 very basic iterations of tdd-ing a flow.
                By stepping out the sequence of events that take place in this style of test, it's very easy to make
                additions and adjustments to the way the app works.
                We've only shown you a snippet of one flow that will take place in this app, which happens to go down a
                happy path. There will in fact be a number of flows that emerge before this game is complete
                These might include...


                Since getting to this point, we've actually managed to get the app in a more complete state so we
                could play a game with you - do you guys want to play??
            </aside>
        </section>
        <!-- 3 basic iterations building out the code -->

        <section>
            <h3>Let's play!</h3>
            <div>Just cause we built it, lets play a game!</div>

            <aside class="notes">
                probably exit and play the live game with the audience now...
            </aside>
        </section>

        <section>
            <h3>Summary</h3>
            <ul>
                <li>Testing matters</li>
                <li>The unit under test</li>
                <li>Testing behaviour</li>
                <li>Documenting behaviour (Given, When, Then)</li>
                <li>Iteration - small frequent changes</li>
            </ul>

            <aside class="notes">
                note: although this talk focused on flows, these points all apply to testing any unit at any level
                <!-- # TODO example: maybe talk over an isolated unit test of the round controller? -->
            </aside>
        </section>

        <section>
            <h3>Resources</h3>
            <ul>
                <li>Github</li>
                <li>Heroku</li>
            </ul>
            <div>
                Selena twitter, linkedin, github
            </div>
            <div>
                Michael twitter, linkedin, github
            </div>
        </section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
  // More info about config & dependencies:
  // - https://github.com/hakimel/reveal.js#configuration
  // - https://github.com/hakimel/reveal.js#dependencies
  Reveal.initialize({
    dependencies: [
      { src: 'plugin/markdown/marked.js' },
      { src: 'plugin/markdown/markdown.js' },
      { src: 'plugin/notes/notes.js', async: true },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
    ],
    transition: 'none',
  });
</script>
</body>
</html>
